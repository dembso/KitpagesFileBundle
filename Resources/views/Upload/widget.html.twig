<script type="text/javascript">
    // TODO : javascript ugly, write a simple jQuery plugin...
$(document).ready(function() {
    var displayThumbnail = function(tab) {
        if (tab) {
            $("#kit-file-container-{{ fieldId }} ul.kit-file-image-list").html(
                '<li><img src="'+tab.url+'" width="50"/> '+tab.fileName+' <a class="kit-file-delete-upload">[X]</a></li>'
            );
        }
        else {
            $("#kit-file-container-{{ fieldId }} ul.kit-file-image-list").html('');
        }
    }
    $('#kit-file-upload-{{ fieldId }}').uploadify({
        'uploader'  : '{{ asset ("bundles/kitpagesfile/uploadify/uploadify.swf") }}',
        'script'    : '{{ path('file_upload_do_upload') }}',
        'checkScript' : '{{ path('file_upload_check') }}',
        'cancelImg' : '{{ asset ("bundles/kitpagesfile/uploadify/cancel.png") }}',
        'folder'    : '/glouglou',
        'buttonText': 'Upload a image',
        //'multi' : true,
        'auto'      : true,
        'onComplete' : function(event, ID, fileObj, response, data) {
            var tab = $.parseJSON(response);
            $("#{{ fieldId }}").attr('value', tab.id);
            displayThumbnail(tab);
        }
    });
  
    var fileId = $("#{{ fieldId }}").attr('value');
    if (fileId) {
        $.ajax({
            type: "POST",
            url: "{{ path('kitpages_file_info') }}",
            dataType: 'json',
            data: "id="+fileId,
            success: function(data) {
                displayThumbnail(data);
            }
        });
    }
    
    $("#kit-file-container-{{ fieldId }}").delegate(
        "a.kit-file-delete-upload",
        "click",
        function() {
            var res = confirm("Are you sure you want delete this image ?");
            if (res == false) {
                return;
            }
            $("#{{ fieldId }}").attr('value', '');
            displayThumbnail();
        }
    );
});
</script>
<div id="kit-file-container-{{ fieldId }}" class="kit-file-container">
    <input id="kit-file-upload-{{ fieldId }}" class="file-upload-field" name="file-upload-{{ fieldId }}" type="file" />
    <ul class="kit-file-image-list">
    </ul>
</div>
